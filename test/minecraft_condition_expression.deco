@load
int main() {
    print("");
    print("--- Running condition expression tests ---");

    // Setup scoreboard
    @`scoreboard objectives add deco_test dummy`;

    test_simple_true_condition();
    test_simple_false_condition();
    test_negated_condition();
    test_complex_conditions();

    print("");
    print("--- All condition expression tests complete ---");
}

// Helper function to print test results
void check(string testName, bool passed) {
    if (passed) {
        print("[PASS] ", testName);
    } else {
        print("[FAIL] ", testName);
    }
}

// Test 1: "..." that is true
void test_simple_true_condition() {
    print("");
    print("--- Testing simple true condition ---");
    bool executed;
    executed = false;
    @`scoreboard players set cond_true deco_test 1`;

    if ("score cond_true deco_test matches 1") {
        executed = true;
    }
    check("if(\"...\") -> true executes", executed == true);
}

// Test 2: "..." that is false
void test_simple_false_condition() {
    print("");
    print("--- Testing simple false condition ---");
    bool executed;
    executed = true;
    @`scoreboard players set cond_false deco_test 0`;

    if ("score cond_false deco_test matches 1") {
        print("执行了");
        executed = false;
    }
    check("if(\"...\") -> false does not execute", executed == true);
}

// Test 3: Negated condition !"..."
void test_negated_condition() {
    print("");
    print("--- Testing negated condition ---");
    bool result;

    // Test !true -> should be false
    @`scoreboard players set cond_neg_true deco_test 1`;
    result = !"score cond_neg_true deco_test matches 1";
    check("!\"(true)\" is false", result == false);

    // Test !false -> should be true
    @`scoreboard players set cond_neg_false deco_test 0`;
    result = !"score cond_neg_false deco_test matches 1";
    check("!\"(false)\" is true", result == true);
}

// Test 4: Complex conditions with && and ||
void test_complex_conditions() {
    print("");
    print("--- Testing complex conditions ---");
    bool executed;
    executed = false;

    @`scoreboard players set complex_A deco_test 1`;
    @`scoreboard players set complex_B deco_test 0`;

    // Test 4.1: true && "..." (true)
    executed = false;
    if (true && "score complex_A deco_test matches 1") {
        executed = true;
    }
    check("complex: true && \"(true)\"", executed == true);

    // Test 4.2: true && "..." (false)
    executed = true;
    if (true && "score complex_B deco_test matches 1") {
        executed = false;
    }
    check("complex: true && \"(false)\"", executed == true);

    // Test 4.3: false || "..." (true)
    executed = false;
    if (false || "score complex_A deco_test matches 1") {
        executed = true;
    }
    check("complex: false || \"(true)\"", executed == true);

    // Test 4.4: "(true)" || "(false)"
    executed = false;
    if ("score complex_A deco_test matches 1" || "score complex_B deco_test matches 1") {
        executed = true;
    }
    check("complex: \"(true)\" || \"(false)\"", executed == true);
    
    // Test 4.5: "(false)" && "(true)"
    executed = true;
    if ("score complex_B deco_test matches 1" && "score complex_A deco_test matches 1") {
        executed = false;
    }
    check("complex: \"(false)\" && \"(true)\"", executed == true);
}
